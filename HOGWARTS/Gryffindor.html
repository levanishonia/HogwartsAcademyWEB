<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>áƒ’áƒ áƒ˜áƒ¤áƒ˜áƒœáƒ“áƒáƒ áƒ˜áƒ¡ áƒ¡áƒáƒ˜áƒ“áƒ£áƒ›áƒšáƒ áƒáƒ—áƒáƒ®áƒ˜</title>
    <link rel="stylesheet" href="Styles/style.css"> 
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
</head>
<body class="gryffindor-bg">
    
    <main class="house-page">
        <section class="house-content" data-aos="zoom-in">
            <h2>áƒ›áƒáƒ’áƒ”áƒ¡áƒáƒšáƒ›áƒ”áƒ‘áƒ˜áƒ—, áƒ›áƒáƒ›áƒáƒªáƒ”áƒ‘áƒ áƒ’áƒ áƒ˜áƒ¤áƒ˜áƒœáƒ“áƒáƒ áƒ”áƒšáƒ”áƒ‘áƒ!</h2>
            <p>áƒ›áƒ®áƒáƒšáƒáƒ“ áƒ§áƒ•áƒ”áƒšáƒáƒ–áƒ” áƒ›áƒáƒ›áƒáƒªáƒ˜ áƒ’áƒ£áƒšáƒ”áƒ‘áƒ˜ áƒáƒ¦áƒ¬áƒ”áƒ•áƒ”áƒœ áƒáƒ› áƒáƒ“áƒ’áƒ˜áƒšáƒáƒ›áƒ“áƒ”.</p>
            
            <div class="news-section">
                <h3>ğŸ  áƒ’áƒ áƒ˜áƒ¤áƒ˜áƒœáƒ“áƒáƒ áƒ˜áƒ¡ áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ˜ (áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒ¢áƒáƒ áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡)</h3>
                
                <form id="newsForm" style="margin-bottom: 20px;">
                    <input type="text" id="newsTitle" placeholder="áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜" style="width: 100%; padding: 8px; margin-bottom: 10px;">
                    <textarea id="newsContent" placeholder="áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡ áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜" rows="3" style="width: 100%; padding: 8px;"></textarea>
                    <button type="submit" style="padding: 10px; background-color: #740001; color: #FFD700; border: none; cursor: pointer;">áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</button>
                </form>

                <div id="newsFeed">
                    <div class="news-item">
                        <h4>ğŸ° áƒ™áƒ•áƒ˜áƒ áƒ˜áƒ¡ áƒ¨áƒ”áƒ™áƒ áƒ”áƒ‘áƒ:</h4>
                        <p>áƒ›áƒáƒ›áƒ“áƒ”áƒ•áƒœáƒ áƒ¨áƒáƒ‘áƒáƒ—áƒ¡, áƒ¡áƒáƒ¦áƒáƒ›áƒáƒ¡ 7 áƒ¡áƒáƒáƒ—áƒ–áƒ”, áƒ“áƒ˜áƒ“ áƒ“áƒáƒ áƒ‘áƒáƒ–áƒ¨áƒ˜! áƒáƒ  áƒ“áƒáƒ’áƒáƒ•áƒ˜áƒ¬áƒ§áƒ“áƒ”áƒ— áƒ¡áƒáƒ˜áƒ“áƒ£áƒ›áƒšáƒ áƒáƒáƒ áƒáƒšáƒ˜.</p>
                        <small>áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ: áƒáƒ áƒáƒ¤. áƒ›áƒáƒ™áƒ’áƒáƒœáƒáƒ’áƒ”áƒšáƒ›áƒ</small>
                    </div>
                </div>
            </div>

            <div class="chat-section">
                <h3>ğŸ’¬ áƒ’áƒ áƒ˜áƒ¤áƒ˜áƒœáƒ“áƒáƒ áƒ˜áƒ¡ áƒ›áƒ˜áƒ›áƒáƒ¬áƒ”áƒ áƒ (áƒšáƒáƒ˜áƒ• áƒ©áƒáƒ¢áƒ˜)</h3>
                <div class="chat-box" id="chatBox">
                    <div class="chat-message other"><span>áƒáƒ áƒáƒ¤. áƒ›áƒáƒ™áƒ’áƒáƒœáƒáƒ’áƒ”áƒšáƒ˜: áƒ›áƒ¨áƒ•áƒ”áƒœáƒ˜áƒ”áƒ áƒ˜áƒ, áƒ áƒáƒ› áƒ”áƒ¡ áƒáƒ—áƒáƒ®áƒ˜ áƒ˜áƒáƒáƒ•áƒ”áƒ—!</span></div>
                </div>
                
                <input type="text" id="chatInput" placeholder="áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ”áƒ— áƒ¨áƒ”áƒ¢áƒ§áƒáƒ‘áƒ˜áƒœáƒ”áƒ‘áƒ..." style="width: 80%; padding: 8px;">
                <button onclick="sendMessage()" style="width: 18%; padding: 8px; background-color: #740001; color: #FFD700; border: none; cursor: pointer;">áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ</button>
            </div>
            
            <a href="index.html" style="color: #FFD700; font-weight: bold; display: block; margin-top: 30px;">áƒ“áƒáƒ‘áƒ áƒ£áƒœáƒ“áƒ˜ áƒáƒ™áƒáƒ“áƒ”áƒ›áƒ˜áƒáƒ¨áƒ˜</a>
        </section>
    </main>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
      AOS.init({ duration: 1000, once: true });
    </script>
    <button id="backToTopBtn" class="back-to-top" aria-label="áƒáƒ¡áƒ¥áƒ áƒáƒšáƒ•áƒ áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜áƒ¡ áƒ—áƒáƒ•áƒ–áƒ”">&#9650;</button>
    <script src="Scripts/styles/backToTop.js"></script> 
    <script src="/socket.io/socket.io.js"></script> 
    
    <script>
    // =========================================================
    // âœ… 1. áƒªáƒ•áƒšáƒáƒ“áƒ”áƒ‘áƒ˜áƒ¡ áƒ˜áƒœáƒ˜áƒªáƒ˜áƒáƒšáƒ˜áƒ–áƒáƒªáƒ˜áƒ
    // =========================================================
    const socket = io(); 
    const chatBox = document.getElementById('chatBox');
    const newsFeed = document.getElementById('newsFeed');
    
    // áƒ“áƒ áƒáƒ”áƒ‘áƒ˜áƒ—áƒ˜ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜
    const userName = 'áƒ’áƒ áƒ˜áƒ¤áƒ˜áƒœáƒ“áƒáƒ áƒ”áƒšáƒ˜_' + Math.floor(Math.random() * 100);

    // =========================================================
    // âœ… 2. áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ (POST, FETCH, DELETE)
    // =========================================================

    // áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ: áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ˜áƒ¡ HTML-áƒ¨áƒ˜ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ (áƒ¬áƒáƒ¨áƒšáƒ˜áƒ¡ áƒ¦áƒ˜áƒšáƒáƒ™áƒ˜áƒ¡ áƒ©áƒáƒ—áƒ•áƒšáƒ˜áƒ—)
    function addNewsToFeed(post) {
        // áƒ—áƒ£ áƒáƒáƒ¡áƒ¢áƒ˜ áƒ£áƒ™áƒ•áƒ” áƒáƒ áƒ¡áƒ”áƒ‘áƒáƒ‘áƒ¡ (Socket.IO-áƒ¡ áƒ’áƒáƒáƒ áƒ›áƒáƒ’áƒ”áƒ‘áƒ˜áƒ¡ áƒ—áƒáƒ•áƒ˜áƒ“áƒáƒœ áƒáƒ¡áƒáƒªáƒ˜áƒšáƒ”áƒ‘áƒšáƒáƒ“)
        if (document.getElementById(`news-post-${post.id}`)) {
            return; 
        }

        const newPost = document.createElement('div');
        newPost.classList.add('news-item');
        newPost.id = `news-post-${post.id}`; // âœ… áƒ£áƒœáƒ˜áƒ™áƒáƒšáƒ£áƒ áƒ˜ ID áƒ¬áƒáƒ¨áƒšáƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡
        
        const formattedDate = new Date(post.timestamp).toLocaleDateString('ka-GE');

        newPost.innerHTML = `
            <h4>ğŸ”¥ ${post.title}</h4>
            <p>${post.content}</p>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
                <small>áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ: ${post.user} | ${formattedDate}</small>
                <button class="delete-news-btn" 
                        data-post-id="${post.id}" 
                        style="background-color: #A00000; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 5px; font-size: 12px; transition: background-color 0.2s;"
                        onmouseover="this.style.backgroundColor='#740001';"
                        onmouseout="this.style.backgroundColor='#A00000';">
                    áƒ¬áƒáƒ¨áƒšáƒ
                </button>
            </div>
        `;
        
        // áƒáƒ®áƒáƒšáƒ˜ áƒáƒáƒ¡áƒ¢áƒ˜ áƒ“áƒáƒ”áƒ›áƒáƒ¢áƒáƒ¡ áƒ¡áƒ˜áƒ˜áƒ¡ áƒ—áƒáƒ•áƒ¨áƒ˜
        newsFeed.prepend(newPost); 
    }
    
    // áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ: áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ˜áƒ“áƒáƒœ áƒ¬áƒáƒ›áƒáƒ¦áƒ”áƒ‘áƒ áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ˜áƒ¡áƒáƒ¡
    async function fetchInitialNews() {
        try {
            const response = await fetch('/api/news');
            const news = await response.json();
            
            // áƒ¬áƒáƒ¨áƒáƒšáƒ”áƒ— áƒ¡áƒáƒ¬áƒ§áƒ˜áƒ¡áƒ˜ HTML-áƒ˜áƒ¡ áƒáƒáƒ¡áƒ¢áƒ˜
            newsFeed.innerHTML = ''; 

            // áƒ“áƒáƒáƒ›áƒáƒ¢áƒ”áƒ— áƒ§áƒ•áƒ”áƒšáƒ áƒ¨áƒ”áƒœáƒáƒ®áƒ£áƒšáƒ˜ áƒ¡áƒ˜áƒáƒ®áƒšáƒ”
            news.forEach(post => addNewsToFeed(post));

        } catch (error) {
            console.error('áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ:', error);
            newsFeed.innerHTML = '<p style="color:#FFD700;">áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ.</p>';
        }
    }

    // áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ: áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ–áƒ” áƒ¬áƒáƒ¨áƒšáƒ˜áƒ¡ áƒ›áƒáƒ—áƒ®áƒáƒ•áƒœáƒ˜áƒ¡ áƒ’áƒáƒ¡áƒáƒ’áƒ–áƒáƒ•áƒœáƒáƒ“
    async function deleteNewsPost(postId) {
        if (!confirm('áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒáƒ› áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ?')) {
            return;
        }
        
        try {
            const response = await fetch(`/api/news/${postId}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                // áƒšáƒáƒ™áƒáƒšáƒ£áƒ áƒáƒ“ áƒ¬áƒáƒ¨áƒšáƒ (Socket.IO-áƒ—áƒ˜ áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ—áƒáƒ•áƒ˜áƒ“áƒáƒœ áƒáƒ¡áƒáƒªáƒ˜áƒšáƒ”áƒ‘áƒšáƒáƒ“)
                document.getElementById(`news-post-${postId}`).remove();
            } else {
                const error = await response.json();
                alert('áƒ¬áƒáƒ¨áƒšáƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: ' + error.message);
            }
        } catch (error) {
            console.error('Error deleting post:', error);
            alert('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ—áƒáƒœ áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜áƒ¡áƒáƒ¡.');
        }
    }

    // áƒ›áƒáƒ•áƒšáƒ”áƒœáƒ: áƒ¤áƒáƒ áƒ›áƒ˜áƒ¡ áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ (áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ)
    document.getElementById('newsForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const title = document.getElementById('newsTitle').value;
        const content = document.getElementById('newsContent').value;

        if (!title || !content) {
            alert('áƒ’áƒ—áƒ®áƒáƒ•áƒ—, áƒ¨áƒ”áƒáƒ•áƒ¡áƒáƒ— áƒ áƒáƒ’áƒáƒ áƒª áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜, áƒ˜áƒ¡áƒ” áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜.');
            return;
        }

        const response = await fetch('/api/news', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ 
                title, 
                content, 
                user: "áƒáƒ“áƒ›áƒ˜áƒœáƒ˜ (áƒ“áƒ áƒáƒ”áƒ‘áƒ˜áƒ—)"
            })
        });

        const result = await response.json();

        if (result.success) {
            document.getElementById('newsTitle').value = '';
            document.getElementById('newsContent').value = '';
            // áƒáƒ  áƒ’áƒ•áƒ­áƒ˜áƒ áƒ“áƒ”áƒ‘áƒ addNewsToFeed áƒáƒ¥, áƒ áƒáƒ“áƒ’áƒáƒœ Socket.IO áƒ’áƒáƒ›áƒáƒáƒ’áƒ–áƒáƒ•áƒœáƒ˜áƒ¡ áƒ›áƒáƒ¡
            alert('áƒ¡áƒ˜áƒáƒ®áƒšáƒ” áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ“áƒáƒ”áƒ›áƒáƒ¢áƒ!');
        } else {
            alert('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ¡áƒáƒ¡: ' + result.message);
        }
    });

    // Socket.IO: áƒ›áƒáƒ£áƒ¡áƒ›áƒ˜áƒœáƒ”áƒ— áƒáƒ®áƒáƒš áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ¡
    socket.on('newNewsPost', function(post) {
        addNewsToFeed(post);
    });

    // Socket.IO: áƒ›áƒáƒ£áƒ¡áƒ›áƒ˜áƒœáƒ”áƒ— áƒ¬áƒáƒ¨áƒšáƒ˜áƒ¡ áƒ”áƒ•áƒ”áƒœáƒ¢áƒ¡ áƒ¡áƒ®áƒ•áƒ áƒ™áƒšáƒ˜áƒ”áƒœáƒ¢áƒ”áƒ‘áƒ˜áƒ“áƒáƒœ
    socket.on('deleteNewsPost', function(data) {
        const element = document.getElementById(`news-post-${data.id}`);
        if (element) {
            element.remove();
        }
    });

    // âœ… áƒáƒ®áƒáƒšáƒ˜: áƒ¦áƒ˜áƒšáƒáƒ™áƒ”áƒ‘áƒ–áƒ” áƒ“áƒáƒ­áƒ”áƒ áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ (áƒ¬áƒáƒ¨áƒšáƒ áƒ¦áƒ˜áƒšáƒáƒ™áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡)
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('delete-news-btn')) {
            const postId = e.target.getAttribute('data-post-id');
            deleteNewsPost(postId);
        }
    });
    
    // =========================================================
    // âœ… 3. áƒ©áƒáƒ¢áƒ˜áƒ¡ áƒšáƒáƒ’áƒ˜áƒ™áƒ (Socket.IO)
    // =========================================================

    function sendMessage() {
        const input = document.getElementById('chatInput');
        const messageText = input.value.trim();
        
        if (messageText) {
            const messageObject = {
                user: userName,
                text: messageText,
                timestamp: new Date().toLocaleTimeString('ka-GE')
            };
            
            socket.emit('chatMessage', messageObject); 
            input.value = '';
        }
    }
    
    socket.on('chatMessage', function(msg) {
        const isMe = msg.user === userName;
        
        const messageElement = document.createElement('div');
        messageElement.classList.add('chat-message', isMe ? 'me' : 'other'); 
        
        messageElement.innerHTML = `
            <div style="display:flex; flex-direction:column; align-items: ${isMe ? 'flex-end' : 'flex-start'};">
                ${!isMe ? `<small style="font-size:12px; color:#FFD700; font-weight:bold; margin-bottom: 3px;">${msg.user}</small>` : ''}
                <span>${msg.text}</span>
                <small style="font-size:10px; opacity:0.6; margin-top:2px;">${msg.timestamp}</small>
            </div>
        `;
        
        chatBox.appendChild(messageElement);
        chatBox.scrollTop = chatBox.scrollHeight;
    });

    document.getElementById('chatInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });

    // âœ… 4. áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ˜áƒ¡áƒáƒ¡ áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ˜áƒ¡ áƒ¬áƒáƒ›áƒáƒ¦áƒ”áƒ‘áƒ
    document.addEventListener('DOMContentLoaded', fetchInitialNews);
</script>
</body>
</html>